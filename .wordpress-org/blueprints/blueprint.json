{
  "$schema": "https://playground.wordpress.net/blueprint-schema.json",
  "landingPage": "/wp-admin/post.php?post=42&action=edit",
  "preferredVersions": {
    "php": "8.3",
    "wp": "latest"
  },
  "features": {
    "networking": true
  },
  "steps": [
    {
      "step": "setSiteOptions",
      "options": {
        "blogname": "Query Posts Grouped by Taxonomy",
        "blogdescription": "Extending `core/query` with a GROUPBY option.",
        "users_can_register": 1,
        "permalink_structure": "/%year%/%monthnum%/%postname%/"
      }
    },
    {
      "step": "login",
      "username": "admin"
    },
    {
      "step": "updateUserMeta",
      "meta": {
          "admin_color": "modern"
      },
      "userId": 1
    },
    {
      "step": "installPlugin",
      "pluginData": {
        "resource": "git:directory",
        "url": "https://github.com/carstingaxion/query-groupedby-taxonomy",
        "ref": "HEAD"
      },
      "options": {
        "activate": true
      },
      "progress": {
        "caption": "Installing plugin from GitHub: carstingaxion/query-groupedby-taxonomy"
      }
    },
{
			"step": "runPHP",
			"code": "<?php require '/wordpress/wp-load.php'; $tags = array( 'Apples' => 0, 'Oranges' => 0, 'Bananas' => 0, 'Grapes' => 0, 'Mangoes' => 0 ); foreach ( array_keys( $tags ) as $tag_name ) { $term = wp_insert_term( $tag_name, 'post_tag' ); if ( ! is_wp_error( $term ) ) { $tags[ $tag_name ] = $term['term_id']; } else { $existing = get_term_by( 'name', $tag_name, 'post_tag' ); if ( $existing ) { $tags[ $tag_name ] = $existing->term_id; } } } $posts_data = array( array( 'title' => 'Best Apple Pie Recipe', 'content' => 'A classic apple pie that never fails to impress your guests.', 'tag' => 'Apples' ), array( 'title' => 'Apple Cider for Autumn', 'content' => 'Warm up with this homemade apple cider recipe perfect for fall evenings.', 'tag' => 'Apples' ), array( 'title' => 'Growing Apple Trees at Home', 'content' => 'A beginner guide to planting and caring for apple trees in your backyard.', 'tag' => 'Apples' ), array( 'title' => 'Fresh Orange Juice Tips', 'content' => 'How to make the perfect glass of orange juice every morning.', 'tag' => 'Oranges' ), array( 'title' => 'Orange Marmalade from Scratch', 'content' => 'A traditional recipe for homemade orange marmalade with a tangy twist.', 'tag' => 'Oranges' ), array( 'title' => 'Banana Bread Perfection', 'content' => 'The ultimate banana bread recipe — moist, sweet, and easy to bake.', 'tag' => 'Bananas' ), array( 'title' => 'Banana Smoothie Bowls', 'content' => 'Start your day with a thick and creamy banana smoothie bowl topped with granola.', 'tag' => 'Bananas' ), array( 'title' => 'Grape Harvest Season Guide', 'content' => 'Everything you need to know about grape harvesting and winemaking basics.', 'tag' => 'Grapes' ), array( 'title' => 'Frozen Grape Snacks', 'content' => 'A simple and healthy snack — frozen grapes are natures candy.', 'tag' => 'Grapes' ), array( 'title' => 'Mango Sticky Rice Recipe', 'content' => 'A beloved Thai dessert combining sweet mango with coconut sticky rice.', 'tag' => 'Mangoes' ), array( 'title' => 'How to Pick a Ripe Mango', 'content' => 'Tips and tricks for selecting the perfect mango at the grocery store.', 'tag' => 'Mangoes' ), array( 'title' => 'Mango Salsa for Summer', 'content' => 'A refreshing mango salsa that pairs perfectly with grilled fish or chips.', 'tag' => 'Mangoes' ) ); $delay = 0; foreach ( $posts_data as $post_item ) { $post_id = wp_insert_post( array( 'post_title' => $post_item['title'], 'post_content' => '<!-- wp:paragraph --><p>' . $post_item['content'] . '</p><!-- /wp:paragraph -->', 'post_status' => 'publish', 'post_type' => 'post', 'post_date' => gmdate( 'Y-m-d H:i:s', time() - ( $delay * 3600 ) ), ) ); if ( ! is_wp_error( $post_id ) && isset( $tags[ $post_item['tag'] ] ) && $tags[ $post_item['tag'] ] > 0 ) { wp_set_post_terms( $post_id, array( (int) $tags[ $post_item['tag'] ] ), 'post_tag' ); } $delay++; }",
      "progress": {
        "caption": "Inserting demo posts with tags: Apples, Oranges, Bananas, Grapes, Mangoes"
      }
		},
    {
      "step": "runPHP",
      "code": "<?php require_once '/wordpress/wp-load.php';\n$page_args = array(\n'post_type'    => 'post',\n'post_status'  => 'publish',\n'post_title'   => 'Grouped Query Demo',\n'post_content' => '<!-- wp:query {\\\"queryId\\\":1,\\\"query\\\":{\\\"perPage\\\":12,\\\"pages\\\":0,\\\"offset\\\":0,\\\"postType\\\":\\\"post\\\",\\\"order\\\":\\\"desc\\\",\\\"orderBy\\\":\\\"date\\\",\\\"author\\\":\\\"\\\",\\\"search\\\":\\\"\\\",\\\"exclude\\\":[],\\\"sticky\\\":\\\"\\\",\\\"inherit\\\":false,\\\"groupByTaxonomy\\\":\\\"post_tag\\\"},\\\"groupByTaxonomy\\\":\\\"post_tag\\\"} --><div class=\\\"wp-block-query\\\"><!-- wp:post-template --><!-- wp:post-title {\\\"isLink\\\":true} /--><!-- wp:post-excerpt /--><!-- wp:post-terms {\\\"term\\\":\\\"post_tag\\\"} /--><!-- /wp:post-template --><!-- wp:query-no-results --><!-- wp:paragraph --><p>No posts found.</p><!-- /wp:paragraph --><!-- /wp:query-no-results --></div><!-- /wp:query -->',\n'import_id'    => 42,\n);\n$page_id = wp_insert_post( $page_args, true );\nif ( is_wp_error( $page_id ) ) {\nerror_log( 'addPost error: ' . $page_id->get_error_message() );\n}",
      "progress": {
        "caption": "Crafting new post: Grouped Query Demo"
      }
    }
  ]
}