(()=>{"use strict";const o=window.wp.i18n,e=window.wp.hooks,t=window.wp.compose,n=window.wp.blockEditor,r=window.wp.components,i=window.wp.data,s=window.wp.coreData,a=window.wp.element,y=window.ReactJSXRuntime;function u({attributes:e,setAttributes:t}){const{query:u,groupByTaxonomy:l}=e,p=u?.postType||"post",{taxonomyOptions:d,isLoading:m}=(0,i.useSelect)(e=>{const{getTaxonomies:t,isResolving:n}=e(s.store),r=t({type:p,per_page:-1}),i=n("getTaxonomies",[{type:p,per_page:-1}]),a=[{label:(0,o.__)("— None (no grouping) —","query-groupedby-taxonomy"),value:""}];return Array.isArray(r)&&r.filter(o=>o.visibility?.publicly_queryable||o.visibility?.show_ui).forEach(o=>{a.push({label:o.name,value:o.slug})}),{taxonomyOptions:a,isLoading:i}},[p]);(0,a.useEffect)(()=>{if(!l||m)return;const o=d.map(o=>o.value).filter(Boolean);o.length>0&&!o.includes(l)&&t({groupByTaxonomy:""})},[d,l,m,t]);const g=(0,a.useMemo)(()=>{if(!u)return null;const o={...u};return l?o.groupByTaxonomy=l:delete o.groupByTaxonomy,o},[u,l]);return(0,a.useEffect)(()=>{g&&u&&(u.groupByTaxonomy||"")!==(g.groupByTaxonomy||"")&&t({query:g})},[g,u,t]),(0,y.jsx)(n.InspectorControls,{children:(0,y.jsxs)(r.PanelBody,{title:(0,o.__)("Group by Taxonomy","query-groupedby-taxonomy"),initialOpen:!0,className:"query-groupedby-taxonomy-panel",children:[m&&(0,y.jsxs)("div",{className:"query-groupedby-taxonomy-panel__loading",children:[(0,y.jsx)(r.Spinner,{}),(0,y.jsx)("span",{children:(0,o.__)("Loading taxonomies…","query-groupedby-taxonomy")})]}),!m&&d.length>1&&(0,y.jsx)(y.Fragment,{children:(0,y.jsx)(r.SelectControl,{label:(0,o.__)("Taxonomy","query-groupedby-taxonomy"),value:l||"",options:d,onChange:o=>t({groupByTaxonomy:o}),help:l?(0,o.__)("Posts will be grouped by this taxonomy on the front end.","query-groupedby-taxonomy"):(0,o.__)("Select a taxonomy to enable grouping.","query-groupedby-taxonomy"),__nextHasNoMarginBottom:!0})}),!m&&d.length<=1&&(0,y.jsx)(r.Notice,{status:"warning",isDismissible:!1,children:(0,o.__)("No public taxonomies found for the selected post type.","query-groupedby-taxonomy")})]})})}const l=(0,t.createHigherOrderComponent)(o=>e=>"core/query"!==e.name?(0,y.jsx)(o,{...e}):(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(o,{...e}),(0,y.jsx)(u,{attributes:e.attributes,setAttributes:e.setAttributes})]}),"withGroupByTaxonomyControls");(0,e.addFilter)("editor.BlockEdit","carstingaxion/query-groupedby-taxonomy",l)})();